<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã©ã†ãŒ ã ã†ã‚“ã‚ãƒ¼ã ã ğŸš€</title>
  <link rel="icon" href="{{ url_for('static', filename='yt-dlp_image.png') }}" type="image/png">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="background-animation">
    <div class="floating-shape shape-1"></div>
    <div class="floating-shape shape-2"></div>
    <div class="floating-shape shape-3"></div>
    <div class="floating-shape shape-4"></div>
    <div class="floating-shape shape-5"></div>
    <div class="floating-shape shape-6"></div>
    <div class="floating-shape shape-7"></div>
    <div class="floating-shape shape-8"></div>
    <div class="floating-shape shape-9"></div>
    <div class="floating-shape shape-10"></div>
  </div>

  <div class="container">
    {% if not ffmpeg_available %}
      <div class="ffmpeg-warning">
        âš ï¸ ffmpegãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚µãƒ ãƒã‚¤ãƒ«ã®åŸ‹ã‚è¾¼ã¿ã«å¤±æ•—ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
      </div>
    {% endif %}
    <header class="header">
      <h1 class="title">
        <span class="title-icon">ğŸ¬</span>
        ã©ã†ãŒ ã ã†ã‚“ã‚ãƒ¼ã ã
        <span class="beta-badge">BETA</span>
      </h1>
      <p class="subtitle">å‹•ç”»ãƒ»éŸ³å£°ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ„ãƒ¼ãƒ«</p>
    </header>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">
            <div class="alert-icon">
              {% if category == 'success' %}â­{% elif category == 'error' %}âš ï¸{% else %}â„¹ï¸{% endif %}
            </div>
            <div class="alert-message">{{ message }}</div>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="download-section">
      <form id="dl-form" method="post" class="download-form">
        <div class="input-group">
          <div class="input-wrapper">
            <div class="input-icon">ğŸ”—</div>
            <input type="text" id="url-input" name="url" placeholder="URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." class="input-url" required>
            <button type="button" id="paste-btn" class="btn-paste" title="ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰è²¼ã‚Šä»˜ã‘">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-clipboard-plus" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                <path fill-rule="evenodd" d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zM8 7a.5.5 0 0 1 .5.5V9H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V10H6a.5.5 0 0 1 0-1h1.5V7.5A.5.5 0 0 1 8 7z"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="format-selection">
          <label class="format-label">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å½¢å¼ã‚’é¸æŠ</label>
          <div class="format-grid">
            {% for val, label, icon in FORMATS %}
              <label class="format-option format-btn">
                <input type="radio" name="format" value="{{ val }}" {% if loop.index == 3 %}checked{% endif %}>
                <div class="format-card">
                  <div class="format-icon">{{ icon }}</div>
                  <div class="format-name">{{ label }}</div>
                </div>
              </label>
            {% endfor %}
          </div>
        </div>

        <button type="submit" class="btn-download">
          <span class="btn-text">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹</span>
          <span class="btn-icon">âš¡</span>
        </button>
      </form>
    </div>

    {% if metadata %}
      <div class="result-section">
        <div class="result-card">
          <div class="result-header">
            <h2>æº–å‚™å®Œäº†ï¼</h2>
            <div class="success-icon">âœ…</div>
          </div>

          <div class="media-info">
            <div class="thumbnail-container">
              {# ç”»åƒãƒ‘ã‚¹ã«æ—¥æœ¬èªãŒå«ã¾ã‚Œã‚‹å ´åˆã¯urlencodeãƒ•ã‚£ãƒ«ã‚¿ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ #}
              <img src="{{ metadata.thumbnail }}" alt="ã‚µãƒ ãƒã‚¤ãƒ«" class="thumbnail" onerror="this.onerror=null;this.src='{{ url_for('static', filename='yt-dlp_image.png') }}'">
            </div>

            <div class="info-panel">
              <h3 class="media-title">{{ metadata.title }}</h3>

              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">ğŸ‘¤ ãƒãƒ£ãƒ³ãƒãƒ«</span>
                  <span class="info-value">{{ metadata.uploader }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">â±ï¸ å†ç”Ÿæ™‚é–“</span>
                  <span class="info-value">{{ metadata.duration }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">ğŸ‘ï¸ å†ç”Ÿå›æ•°</span>
                  <span class="info-value">{{ metadata.views }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">ğŸ“… å…¬é–‹æ—¥</span>
                  <span class="info-value">{{ metadata.upload_date }}</span>
                </div>
              </div>

              <a href="{{ url_for('download_file', filename=metadata.filename) }}" class="download-btn">
                <span class="download-text">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</span>
                <span class="download-format">({{ metadata.ext }})</span>
                <span class="download-icon">â¬‡ï¸</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  </div>

  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-container">
      <div class="loading-bar-container">
        <div class="loading-bar"></div>
      </div>
      <div class="loading-text">
        <h3>å‡¦ç†ä¸­...</h3>
        <p>ã‚ããƒãŒå‹•ç”»ã‚’æ˜ã‚Šå‡ºã—ä¸­...</p>
      </div>
    </div>
  </div>

  <footer class="footer">
    <p>Â© 2025 ã©ã†ãŒ ã ã†ã‚“ã‚ãƒ¼ã ã. Developed by ã‚ããƒ. All rights reserved.</p>
  </footer>

  

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const shapes = document.querySelectorAll('.floating-shape');
      shapes.forEach(shape => {
        const durLarge = Math.random() * 20 + 20;   // å¤§ããå‹•ãæ™‚é–“
        const durBob   = Math.random() * 4 + 4;     // ä¸Šä¸‹æµ®å‹•ã®æ™‚é–“
        const durBlob  = Math.random() * 6 + 6;     // ã·ã‚ˆã·ã‚ˆå¤‰å½¢ã®æ™‚é–“
        shape.style.animation = 
          `floatComplex ${durLarge}s ease-in-out infinite alternate, ` +
          `floatUpDown ${durBob}s ease-in-out infinite alternate, ` +
          `blob ${durBlob}s ease-in-out infinite alternate`;

        shape.addEventListener('mouseenter', e => {
          const rect = shape.getBoundingClientRect();
          const midX = rect.left + rect.width / 2;
          const midY = rect.top  + rect.height / 2;
          const dx = midX - e.clientX;
          const dy = midY - e.clientY;
          const angle = Math.atan2(dy, dx);
          const dist = 100;
          const offsetX = Math.cos(angle) * dist;
          const offsetY = Math.sin(angle) * dist;
          shape.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
          setTimeout(() => { shape.style.transform = ''; }, 500);
        });
      });
    });

    // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé¸æŠæ™‚ã«é¸æŠä¸­ã®ãƒœã‚¿ãƒ³è‡ªä½“ã®è‰²ã‚’å¤‰ãˆã‚‹
    document.addEventListener('DOMContentLoaded', function() {
      const formatOptions = document.querySelectorAll('.format-option input[type="radio"]');
      formatOptions.forEach(function(radio) {
        radio.addEventListener('change', function() {
          document.querySelectorAll('.format-card').forEach(card => card.classList.remove('selected'));
          if (radio.checked) {
            radio.closest('.format-card').classList.add('selected');
          }
        });
        // åˆæœŸé¸æŠçŠ¶æ…‹
        if (radio.checked) {
          radio.closest('.format-card').classList.add('selected');
        }
      });
    });
  </script>
  <script src="{{ url_for('static', filename='js/progress.js') }}"></script>
  <script src="{{ url_for('static', filename='js/ui.js') }}"></script>
  <style>
/* format-cardã®é¸æŠçŠ¶æ…‹ã®è‰²ã‚’ãƒœã‚¿ãƒ³è‡ªä½“ã«é©ç”¨ */
.format-card.selected {
  border-color: var(--accent-gradient);
  background: var(--accent-gradient);
  color: #fff;
  box-shadow: 0 4px 16px rgba(79,172,254,0.15);
  transform: translateY(-2px);
}
.format-card.selected .format-icon,
.format-card.selected .format-name {
  color: #fff;
}
</style>
</body>
</html>